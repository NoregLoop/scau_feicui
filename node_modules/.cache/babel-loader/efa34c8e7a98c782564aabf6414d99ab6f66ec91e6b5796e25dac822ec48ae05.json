{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// fuse is a lightweight fuzzy-search module\n// make search results more in line with expectations\nimport Fuse from 'fuse.js/dist/fuse.min.js';\nimport path from 'path';\nexport default {\n  name: 'HeaderSearch',\n  data() {\n    return {\n      search: '',\n      options: [],\n      searchPool: [],\n      show: false,\n      fuse: undefined\n    };\n  },\n  computed: {\n    routes() {\n      return this.$store.getters.permission_routes;\n    }\n  },\n  watch: {\n    routes() {\n      this.searchPool = this.generateRoutes(this.routes);\n    },\n    searchPool(list) {\n      this.initFuse(list);\n    },\n    show(value) {\n      if (value) {\n        document.body.addEventListener('click', this.close);\n      } else {\n        document.body.removeEventListener('click', this.close);\n      }\n    }\n  },\n  mounted() {\n    this.searchPool = this.generateRoutes(this.routes);\n  },\n  methods: {\n    click() {\n      this.show = !this.show;\n      if (this.show) {\n        this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.focus();\n      }\n    },\n    close() {\n      this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.blur();\n      this.options = [];\n      this.show = false;\n    },\n    change(val) {\n      const path = val.path;\n      if (this.ishttp(val.path)) {\n        // http(s):// 路径新窗口打开\n        const pindex = path.indexOf(\"http\");\n        window.open(path.substr(pindex, path.length), \"_blank\");\n      } else {\n        this.$router.push(val.path);\n      }\n      this.search = '';\n      this.options = [];\n      this.$nextTick(() => {\n        this.show = false;\n      });\n    },\n    initFuse(list) {\n      this.fuse = new Fuse(list, {\n        shouldSort: true,\n        threshold: 0.4,\n        location: 0,\n        distance: 100,\n        minMatchCharLength: 1,\n        keys: [{\n          name: 'title',\n          weight: 0.7\n        }, {\n          name: 'path',\n          weight: 0.3\n        }]\n      });\n    },\n    // Filter out the routes that can be displayed in the sidebar\n    // And generate the internationalized title\n    generateRoutes(routes, basePath = '/', prefixTitle = []) {\n      let res = [];\n      for (const router of routes) {\n        // skip hidden router\n        if (router.hidden) {\n          continue;\n        }\n        const data = {\n          path: !this.ishttp(router.path) ? path.resolve(basePath, router.path) : router.path,\n          title: [...prefixTitle]\n        };\n        if (router.meta && router.meta.title) {\n          data.title = [...data.title, router.meta.title];\n          if (router.redirect !== 'noRedirect') {\n            // only push the routes with title\n            // special case: need to exclude parent router without redirect\n            res.push(data);\n          }\n        }\n\n        // recursive child routes\n        if (router.children) {\n          const tempRoutes = this.generateRoutes(router.children, data.path, data.title);\n          if (tempRoutes.length >= 1) {\n            res = [...res, ...tempRoutes];\n          }\n        }\n      }\n      return res;\n    },\n    querySearch(query) {\n      if (query !== '') {\n        this.options = this.fuse.search(query);\n      } else {\n        this.options = [];\n      }\n    },\n    ishttp(url) {\n      return url.indexOf('http://') !== -1 || url.indexOf('https://') !== -1;\n    }\n  }\n};","map":{"version":3,"names":["Fuse","path","name","data","search","options","searchPool","show","fuse","undefined","computed","routes","$store","getters","permission_routes","watch","generateRoutes","list","initFuse","value","document","body","addEventListener","close","removeEventListener","mounted","methods","click","$refs","headerSearchSelect","focus","blur","change","val","ishttp","pindex","indexOf","window","open","substr","length","$router","push","$nextTick","shouldSort","threshold","location","distance","minMatchCharLength","keys","weight","basePath","prefixTitle","res","router","hidden","resolve","title","meta","redirect","children","tempRoutes","querySearch","query","url"],"sources":["D:\\devprojects\\VsProjects\\Tobacco\\tobacco\\src\\components\\HeaderSearch\\index.vue"],"sourcesContent":["<template>\r\n  <div :class=\"{'show':show}\" class=\"header-search\">\r\n    <svg-icon class-name=\"search-icon\" icon-class=\"search\" @click.stop=\"click\" />\r\n    <el-select\r\n      ref=\"headerSearchSelect\"\r\n      v-model=\"search\"\r\n      :remote-method=\"querySearch\"\r\n      filterable\r\n      default-first-option\r\n      remote\r\n      placeholder=\"Search\"\r\n      class=\"header-search-select\"\r\n      @change=\"change\"\r\n    >\r\n      <el-option v-for=\"option in options\" :key=\"option.item.path\" :value=\"option.item\" :label=\"option.item.title.join(' > ')\" />\r\n    </el-select>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// fuse is a lightweight fuzzy-search module\r\n// make search results more in line with expectations\r\nimport Fuse from 'fuse.js/dist/fuse.min.js'\r\nimport path from 'path'\r\n\r\nexport default {\r\n  name: 'HeaderSearch',\r\n  data() {\r\n    return {\r\n      search: '',\r\n      options: [],\r\n      searchPool: [],\r\n      show: false,\r\n      fuse: undefined\r\n    }\r\n  },\r\n  computed: {\r\n    routes() {\r\n      return this.$store.getters.permission_routes\r\n    }\r\n  },\r\n  watch: {\r\n    routes() {\r\n      this.searchPool = this.generateRoutes(this.routes)\r\n    },\r\n    searchPool(list) {\r\n      this.initFuse(list)\r\n    },\r\n    show(value) {\r\n      if (value) {\r\n        document.body.addEventListener('click', this.close)\r\n      } else {\r\n        document.body.removeEventListener('click', this.close)\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.searchPool = this.generateRoutes(this.routes)\r\n  },\r\n  methods: {\r\n    click() {\r\n      this.show = !this.show\r\n      if (this.show) {\r\n        this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.focus()\r\n      }\r\n    },\r\n    close() {\r\n      this.$refs.headerSearchSelect && this.$refs.headerSearchSelect.blur()\r\n      this.options = []\r\n      this.show = false\r\n    },\r\n    change(val) {\r\n      const path = val.path;\r\n      if(this.ishttp(val.path)) {\r\n        // http(s):// 路径新窗口打开\r\n        const pindex = path.indexOf(\"http\");\r\n        window.open(path.substr(pindex, path.length), \"_blank\");\r\n      } else {\r\n        this.$router.push(val.path)\r\n      }\r\n      this.search = ''\r\n      this.options = []\r\n      this.$nextTick(() => {\r\n        this.show = false\r\n      })\r\n    },\r\n    initFuse(list) {\r\n      this.fuse = new Fuse(list, {\r\n        shouldSort: true,\r\n        threshold: 0.4,\r\n        location: 0,\r\n        distance: 100,\r\n        minMatchCharLength: 1,\r\n        keys: [{\r\n          name: 'title',\r\n          weight: 0.7\r\n        }, {\r\n          name: 'path',\r\n          weight: 0.3\r\n        }]\r\n      })\r\n    },\r\n    // Filter out the routes that can be displayed in the sidebar\r\n    // And generate the internationalized title\r\n    generateRoutes(routes, basePath = '/', prefixTitle = []) {\r\n      let res = []\r\n\r\n      for (const router of routes) {\r\n        // skip hidden router\r\n        if (router.hidden) { continue }\r\n\r\n        const data = {\r\n          path: !this.ishttp(router.path) ? path.resolve(basePath, router.path) : router.path,\r\n          title: [...prefixTitle]\r\n        }\r\n\r\n        if (router.meta && router.meta.title) {\r\n          data.title = [...data.title, router.meta.title]\r\n\r\n          if (router.redirect !== 'noRedirect') {\r\n            // only push the routes with title\r\n            // special case: need to exclude parent router without redirect\r\n            res.push(data)\r\n          }\r\n        }\r\n\r\n        // recursive child routes\r\n        if (router.children) {\r\n          const tempRoutes = this.generateRoutes(router.children, data.path, data.title)\r\n          if (tempRoutes.length >= 1) {\r\n            res = [...res, ...tempRoutes]\r\n          }\r\n        }\r\n      }\r\n      return res\r\n    },\r\n    querySearch(query) {\r\n      if (query !== '') {\r\n        this.options = this.fuse.search(query)\r\n      } else {\r\n        this.options = []\r\n      }\r\n    },\r\n    ishttp(url) {\r\n      return url.indexOf('http://') !== -1 || url.indexOf('https://') !== -1\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.header-search {\r\n  font-size: 0 !important;\r\n\r\n  .search-icon {\r\n    cursor: pointer;\r\n    font-size: 18px;\r\n    vertical-align: middle;\r\n  }\r\n\r\n  .header-search-select {\r\n    font-size: 18px;\r\n    transition: width 0.2s;\r\n    width: 0;\r\n    overflow: hidden;\r\n    background: transparent;\r\n    border-radius: 0;\r\n    display: inline-block;\r\n    vertical-align: middle;\r\n\r\n    ::v-deep .el-input__inner {\r\n      border-radius: 0;\r\n      border: 0;\r\n      padding-left: 0;\r\n      padding-right: 0;\r\n      box-shadow: none !important;\r\n      border-bottom: 1px solid #d9d9d9;\r\n      vertical-align: middle;\r\n    }\r\n  }\r\n\r\n  &.show {\r\n    .header-search-select {\r\n      width: 210px;\r\n      margin-left: 10px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}